<!DOCTYPE html>
<html>
<head>
  <title>Leaflet Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { height: 600px; width: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Sample data equivalent to your CSV content
    const projects = [
      { Client: "Client1", Department: "Urban Forestry/FireSmart", Latitude: "49째14'30\"N", Longitude: "123째6'45\"W", Type: "Type1" },
      { Client: "Client2", Department: "Niche", Latitude: "49째14'40\"N", Longitude: "123째7'15\"W", Type: "Type2" },
      // Add more data here
    ];

    // Function to convert DMS to decimal degrees
    function dmsToDecimal(dms) {
      const parts = dms.split(/[^\d\w]+/);
      const degrees = parseFloat(parts[0]);
      const minutes = parseFloat(parts[1]);
      const seconds = parseFloat(parts[2]);
      let decimal = degrees + minutes / 60 + seconds / 3600;
      if (dms.includes("S") || dms.includes("W")) {
        decimal = -decimal;
      }
      return decimal;
    }

    // Convert data and prepare leaflet input
    const leafletInput = projects.map(project => ({
      Client: project.Client,
      Department: project.Department,
      Lat: dmsToDecimal(project.Latitude),
      Long: dmsToDecimal(project.Longitude),
      Type: project.Type
    }));

    // Remove rows with duplicate values in the 'Client' column
    const uniqueClients = Array.from(new Map(leafletInput.map(item => [item.Client, item])).values());

    // Define color palette by department
    const colorMap = {
      "Urban Forestry/FireSmart": "red",
      "Niche": "blue",
      "Planning": "green",
      "GIS": "purple",
      "Innovations": "orange",
      "Prescriptions/Ops": "yellow",
      "default": "black"
    };

    uniqueClients.forEach(client => {
      client.color = colorMap[client.Department] || colorMap.default;
    });

    // Initialize the map
    const map = L.map('map').setView([49.25, -123.12], 10); // Centered at Vancouver as an example
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Add circle markers
    uniqueClients.forEach(client => {
      L.circleMarker([client.Lat, client.Long], {
        color: client.color,
        radius: 5
      }).addTo(map)
      .bindPopup(`<b>Client:</b> ${client.Client}<br><b>Department:</b> ${client.Department}<br><b>Type:</b> ${client.Type}`)
      .bindTooltip(client.Client);
    });

    // Add legend
    const legend = L.control({ position: 'bottomright' });
    legend.onAdd = function(map) {
      const div = L.DomUtil.create('div', 'info legend');
      const departments = ["Urban Forestry/FireSmart", "Niche", "Planning", "GIS", "Innovations", "Prescriptions/Ops"];
      const colors = ["red", "blue", "green", "purple", "orange", "yellow"];
      for (let i = 0; i < departments.length; i++) {
        div.innerHTML += `<i style="background: ${colors[i]}"></i> ${departments[i]}<br>`;
      }
      return div;
    };
    legend.addTo(map);
  </script>
</body>
</html>
